<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Username and Password authentication for windows 10 and 11</title>
  </head>
  <body>
    <h1>Username and Password authentication for windows 10 and 11</h1>
    <p>Windows 10 and windows 11 24H2 won't let users mount smb - drives without
      username and password anymore. This has stirred up quite some trouble for
      network attached store (NAS - disk) users and this affects FreeLCS also.
      There are two ways to solve this problem. Either enable guest login from
      each windows machine again or start to use username and password
      authentication in FreeLCS. </p>
    <h1>Enable insecure guest logon again in windows</h1>
    <p>In this document microsoft explains why they think this is a beneficial
      change and <strong>how to enable smb - mount guest login again in windows</strong>:
      <a href="https://learn.microsoft.com/en-us/windows-server/storage/file-server/enable-insecure-guest-logons-smb2-and-smb3?tabs=group-policy">https://learn.microsoft.com/en-us/windows-server/storage/file-server/enable-insecure-guest-logons-smb2-and-smb3?tabs=group-policy</a></p>
    <p><br>
    </p>
    <p>Here is another article about the issue: <a href="https://techcommunity.microsoft.com/blog/filecab/accessing-a-third-party-nas-with-smb-in-windows-11-24h2-may-fail/4154300">https://techcommunity.microsoft.com/blog/filecab/accessing-a-third-party-nas-with-smb-in-windows-11-24h2-may-fail/4154300</a></p>
    <br>
    <h1>Username and password authentication for FreeLCS Samba - share</h1>
    <hr><strong># Samba Configuration File<br>
      &nbsp;<br>
      [global]<br>
      workgroup = WORKGROUP<br>
      server string = %h server (Samba, LoudnessCorrection)<br>
      force create mode = 0777<br>
      unix extensions = no<br>
      log file = /var/log/samba/log.%m<br>
      max log size = 1000<br>
      syslog = 0<br>
      panic action = /usr/share/samba/panic-action %d<br>
      security = user<br>
      socket options = TCP_NODELAY<br>
      load printers = no<br>
      force create mode = 0777<br>
      map to guest = never<br>
      # username map = /etc/samba/user.map<br>
      server min protocol = SMB2<br>
      &nbsp;<br>
      [LoudnessCorrection]<br>
      comment = LoudnessCorrection<br>
      read only = no<br>
      locking = no<br>
      path = /mounttipiste/LoudnessCorrection<br>
      guest ok = no<br>
      browseable = yes<br>
      force user = freelcs</strong>
    <hr>
    <p><br>
    </p>
    <ol>
      <li>Copy the text above to <strong>/etc/samba/smb.conf</strong></li>
      <li>Create user: <strong>freelcs</strong> with the command: <strong>useradd
          -M -s /sbin/nologin freelcs</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        (This will create a username that can't be used to login into Linux)</li>
      <li>Add a password for the user (password may be for example: freelcs)
        with the command: <strong>passwd freelcs</strong></li>
      <li>Add the user and its password to Samba database with the command: <strong>smbpasswd
          -a freelcs</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( This asks for user
        password. If missing you can install smbpasswd with: apt install
        samba-common-bin )</li>
      <li>Restart Samba - services: <strong>systemctl restart smbd nmbd</strong></li>
    </ol>
    <h2>Optional configuration</h2>
    <p>There is a way to configure samba to allow any username when mounting the
      share. The user must even then use the password that is configured for the
      default samba user in the samba database.</p>
    <ol>
      <li>Follow all the steps above for creating a linux user adding a password
        for it and adding the same user to Samba user - database. Then uncomment
        the line <strong># username map = /etc/samba/user.map</strong> in <strong>/etc/samba/smb.conf</strong></li>
      <li>Create an additional config - file: <strong>/etc/samba/user.map</strong>&nbsp;&nbsp;
        and add this line in it:</li>
    </ol>
    <p style="margin-left: 40px;"><strong>freelcs = *</strong></p>
    <p>Now Samba ignores the username and always assumes the username is: <strong>freelcs</strong>.
      Users can use their own windows usernames but for password they must use
      the Samba - users: <strong>freelcs</strong> password.</p>
    <h1>Test if the Samba - mount works</h1>
    <p>In Linux use command: <strong>mount -t cifs -o
        username=freelcs,password=freelcs //192.168.1.168/LoudnessCorrection/
        /mnt/</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Adjust the IP -
      address and the last foldername to match your system)</p>
    <p><strong><br>
      </strong></p>
    <p>For windows 11 the mount works like this. </p>
    <ul>
      <li>Open windows file explorer and right - click on "<strong>This PC</strong>"
        Select "<strong>Map Network Drive</strong>" from the menu.</li>
    </ul>
    <p><br>
    </p>
    <p><img src="Pictures/win11_map_network_drive-01.png" alt=""></p>
    <p><br>
    </p>
    <ul>
      <li>Write the address of the server in the window.&nbsp;If your
        installation has a target loudness different from standard -23 LUFS then
        the target loudness is part of the mount path. For example if your
        FreeLCS installation has a target loudness of -16 LUFS, then the mount
        path is something like: <strong>\\192.168.100.109\LoudnessCorrection_-16_LUFS</strong>.
        Make sure that the option "<strong>Reconnect at sign-in</strong>" is
        tagged, without it windows won't make the mount when windows starts
        up.&nbsp; Tag the option "<strong>Connect using different credentials</strong>".
        Click "<strong>Finnish</strong>".</li>
    </ul>
    <p><br>
    </p>
    <p><img src="Pictures/win11_map_network_drive-02.png" alt=""></p>
    <p><br>
    </p>
    <ul>
      <li>Fill in the username and password and optionally tag "<strong>Remember
          my credentials</strong>" if you want windows not to ask for username
        and password for the next time.</li>
    </ul>
    <p><br>
    </p>
    <img src="Pictures/win11_map_network_drive-03.png" alt="">
    <p><br>
    </p>
    <br>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><br>
    </p>
    <p><br>
    </p>
  </body>
</html>
